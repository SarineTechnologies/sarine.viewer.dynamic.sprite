(function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(a){b.__super__.constructor.call(this,a),this.jsonFileName=a.jsonFileName,this.firstImagePath=a.firstImagePath,this.spritesPath=a.spritesPath,this.oneSprite=a.oneSprite,this.metadata=void 0,this.sprites=[],this.currentSprite=0,this.playing=!1,this.delta=1,this.imageIndex=-1,this.imagesDownload=0,this.imagegap=0,this.playOrder={}}var d;return c(b,a),d=function(){function a(a,b){this.column=a.width/b,this.rows=a.height/b,this.image=a,this.totalImage=this.column*this.rows}return a}(),b.prototype.convertElement=function(){return this.canvas=$("<canvas>"),this.ctx=this.canvas[0].getContext("2d"),this.element.append(this.canvas)},b.prototype.first_init=function(){var a,b,c;return a=this.first_init_defer,b={},a.notifyWith(this.id,"load_json","start"),c=this,$.getJSON(this.src+this.jsonFileName,function(b){return c.metadata=b,a.notify(c.id+" : load Json"),c.metadata=b,c.canvas.attr({width:b.ImageSize,height:b.ImageSize}).parent().css("background","#"+b.background),c.delay=1e3/b.FPS,c.playing?c.play():void 0}).then(function(){return a.notify(c.id+" : start load first image"),c.loadImage(c.src+c.firstImagePath).then(function(b){return a.notify(c.id+" : finish load first image"),c.ctx.drawImage(b,0,0,c.metadata.ImageSize,c.metadata.ImageSize),c.imageIndex=0,a.resolve()})}),a},b.prototype.full_init=function(){var a,b;return a=this.full_init_defer,a.notify(this.id+" : start load first image"),b=this,this.downloadSprite(a).then(function(){return b.autoPlay&&b.play(!0),!0}),a},b.prototype.downloadSprite=function(a){var b;return b=this,this.loadImage(this.src+this.spritesPath+(this.oneSprite?"":this.sprites.length)+".jpg").then(function(c){var e;return e=new d(c,b.metadata.ImageSize),b.imagesDownload+=e.column*e.rows,b.sprites.push(e),b.imagesDownload>=b.metadata.TotalImageCount?a.resolve():b.downloadSprite(a),!0})},b.prototype.autoPlayFunc=function(){},b.prototype.nextImage=function(){var a,b,c,d,e;return this.metadata&&this.sprites.length>0?((this.imageIndex+this.delta===this.metadata.TotalImageCount||this.imageIndex+this.delta===this.imagesDownload)&&(this.delta=-1),this.imageIndex+this.delta===-1&&(this.delta=1),this.imageIndex+=this.delta,d=this.sprites[this.currentSprite],(this.imageIndex-this.imagegap)%d.totalImage===0&&this.imageIndex>0&&(1===this.delta?d=this.sprites[++this.currentSprite]:-1===this.delta&&(d=this.sprites[--this.currentSprite]),this.imagegap=this.imageIndex),b=this.imageIndex-this.imagegap+(-1===this.delta?this.sprites[this.currentSprite].totalImage:0),a=parseInt(-1*parseInt(b%d.column)*this.metadata.ImageSize),e=parseInt(-1*parseInt(b/d.rows)*this.metadata.ImageSize),this.playOrder[this.imageIndex]||(this.playOrder[this.imageIndex]={spriteNumber:this.currentSprite,col:a,row:e}),c=this.playOrder[this.imageIndex],this.ctx.drawImage(this.sprites[c.spriteNumber].image,c.col,c.row)):void 0},b}(Viewer.Dynamic),this.Viewer.Dynamic.Sprite=a}).call(this);